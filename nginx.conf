
events {

  worker_connections 1024;

}



http {

  include /etc/nginx/mime.types;

  default_type application/octet-stream;



  sendfile on;

  keepalive_timeout 65;



  gzip on;

  gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;



  # Logging

  access_log /var/log/nginx/access.log;

  error_log /var/log/nginx/error.log;



  server {

    listen 8080;

    server_name localhost;

    root /usr/share/nginx/html;

    index index.html;



    # Health check

    location /health {

      return 200 "healthy\n";

      add_header Content-Type text/plain;

    }



    # API proxy (Cloud Run backend)

    location /api/ {

      proxy_pass https://dino-backend-api-867506203789.us-central1.run.app/api/; # Preserve /api prefix

      proxy_set_header Host dino-backend-api-867506203789.us-central1.run.app; # Required for Cloud Run

      proxy_set_header X-Real-IP $remote_addr;

      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      proxy_set_header X-Forwarded-Proto $scheme;

      proxy_redirect off;

      proxy_connect_timeout 90s;

      proxy_send_timeout 90s;

      proxy_read_timeout 90s;



      # Optional: disable SSL verification for testing only

      proxy_ssl_verify off;

    }



    # WebSocket proxy

    location /ws {

      proxy_pass https://dino-backend-api-867506203789.us-central1.run.app/;

      proxy_http_version 1.1;

      proxy_set_header Upgrade $http_upgrade;

      proxy_set_header Connection "upgrade";

      proxy_set_header Host dino-backend-api-867506203789.us-central1.run.app;

      proxy_set_header X-Real-IP $remote_addr;

      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

      proxy_set_header X-Forwarded-Proto $scheme;

    }



    # React router

    location / {

      try_files $uri $uri/ /index.html;

    }



    # Config endpoint

    location /debug/config {

      alias /usr/share/nginx/html/config.js;

      add_header Content-Type application/javascript;

    }

  }

}


