server {

  listen 8080;

  server_name _;

  root /usr/share/nginx/html;

  index index.html;



  # Security headers

  add_header X-Frame-Options DENY always;

  add_header X-Content-Type-Options nosniff always;

  add_header X-XSS-Protection "1; mode=block" always;

  add_header Referrer-Policy "strict-origin-when-cross-origin" always;

  add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https: wss:;" always;



  # Cache static assets

  location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {

    expires 1y;

    add_header Cache-Control "public, immutable";

    add_header X-Content-Type-Options nosniff;

  }



  # Cache HTML with shorter expiry

  location ~* \.html$ {

    expires 1h;

    add_header Cache-Control "public, must-revalidate";

  }



  # Health check endpoint

  location /health {

    access_log off;

    return 200 '{"status":"healthy","timestamp":"$time_iso8601"}';

    add_header Content-Type application/json;

  }



  # Runtime configuration endpoint

  location /config.js {

    expires 1m;

    add_header Cache-Control "public, must-revalidate";

    add_header Content-Type application/javascript;

  }



  # Handle React Router (SPA)

  location / {

    try_files $uri $uri/ /index.html;

  }



  # Deny access to hidden files

  location ~ /\. {

    deny all;

    access_log off;

    log_not_found off;

  }

}